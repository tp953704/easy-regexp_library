## rollup 外掛篇
今天我們將會介紹，rollup常用的外掛

1. rollup-plugin-buble外掛
> 在rollup.js打包的過程中進行程式碼編譯，將ES6+程式碼編譯成ES5標準

</br>

下載方式
  `npm i -D rollup-plugin-buble`

配置範例:
</br>

```javascript
import buble from 'rollup-plugin-buble'

export default {
  input: './src/vue/buble/index.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }],
  plugins: [
    resolve(),
    commonjs(),
    buble()
  ]
}
```

</br>




  
  </br>
  
2. rollup-plugin-alias外掛
> 提供 modules 名稱的 alias 和 reslove 功能，用過webpack的小夥伴應該對這個功能非常熟悉，首先在專案中引入alias外掛


</br>

下載方式
  `npm i -D rollup-plugin-alias`
  
  </br>
  配置範例:
  
 ```javascript
  
  import alias from 'rollup-plugin-alias'
  import path from 'path'
  //這裡在前置教學有講過喔，這裡就不多介紹了
  const pathResolve = p => path.resolve(__dirname, p)

  export default {
    input: './src/vue/alias/index.js',
    output: [{
      file: './dist/index-plugin-es.js',
      format: 'es'
    }],
    plugins: [
      alias({
      '@': pathResolve('src')
      })
    ]
  }
 ```
 
 </br>
 
3. rollup-plugin-flow-no-whitespace外掛
> flow外掛用於在rollup.js打包過程中清除flow型別檢查部分的程式碼，我們修改rollup.plugin.config.js的input屬性：


</br>

下載方式
  `npm i -D rollup-plugin-flow-no-whitespace`
  
  </br>
  
 配置範例:
 </br>
  
```javascript
import flow from 'rollup-plugin-flow-no-whitespace'

export default {
  input: './src/vue/flow/index.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }],
  plugins: [
    flow()
  ]
}
```
</br>

4.  rollup-plugin-replace外掛
> 類比 Webpack 的 DefinePlugin , 可在源碼中通過 process.env.NODE_ENV 用於構建區分 Development 與 Production 環境
> 程式碼使用了ES6了特性，所以需要引入buble外掛進行編譯
> rollup-plugin-replace: 類比 Webpack 的 DefinePlugin , 可在源碼中通過 process.env.NODE_ENV 用於構建區分 Development 與 Production 環境.

</br>

下載方式
  `npm i -D  rollup-plugin-replace`
  
</br>
配置範例:


```javascript

import buble from 'rollup-plugin-buble'
import replace from 'rollup-plugin-replace'

export default {
  input: './src/vue/replace/index.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }],
  plugins: [
    replace({
    //__SAM__即為編譯過程中的動態變數
    __SAM__: true
    }),
    buble()
  ]
}

```

這裡我們看一下__SAM__到底怎麼去使用

```代編譯文件範例
const a = 1
let b = 2
if (__SAM__) { // 使用replace值__SAM__，注意這個值沒有定義，如果直接執行會報錯
console.log(`__SAM__,${a},${b}`) // 使用__SAM__，打包時會被替換
}
```

</br>
  
5. rollup-plugin-terser外掛
> terser外掛幫助我們在rollup.js打包過程中實現程式碼壓，通常會放在plugin的最後面

</br>

下載方式
  `npm i -D rollup-plugin-terser`  
  
</br>

配置範例

```
import { terser } from 'rollup-plugin-terser'


const pathResolve = p => path.resolve(__dirname, p)

export default {
  input: './src/vue/replace/index.js',
  output: [{
    file: './dist/index-plugin-es.js',
    format: 'es'
  }],
  plugins: [
    terser({
      output: {
      ascii_only: true // 僅輸出ascii字元
    },
    compress: {
      pure_funcs: ['console.log'] // 去掉console.log函式
    }
    }),
  ]
}
```
</br>
  
6. rollup-plugin-resolve外掛
> 整合外部模組程式碼，將我們編寫的原始碼與依賴的第三方庫進行合併，使用者在引用我們庫的時候，就不需要手動去下載這個庫所有的依賴

</br>

```
import resolve from 'rollup-plugin-node-resolve'

export default {
  input: './src/plugin/main.js',
  output: [
  {
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }, {
    file: './dist/index-plugin-es.js',
    format: 'es'
  }],
  plugins: [
    resolve()
  ]
}
```
</br>

下載方式
  `npm i -D rollup-plugin-resolve`  

</br>
  
7. intro和outro配置
intro和outro屬性與我們之前講解的banner和footer屬性類似，都是用來為程式碼添加註釋。那麼這四個屬性之間有什麼區別呢？首先了解一下rollup.js官網對這四個屬性的解釋：

- intro：在打包好的檔案的塊的內部(wrapper內部)的最頂部插入一段內容
- outro：在打包好的檔案的塊的內部(wrapper內部)的最底部插入一段內容
- banner：在打包好的檔案的塊的外部(wrapper外部)的最頂部插入一段內容
- footer：在打包好的檔案的塊的外部(wrapper外部)的最底部插入一段內容 
也就是說intro和outro新增的註釋在程式碼塊的內部，banner和footer在外部


</br>

8. rollup-plugin-commonjs外掛
> rollup.js預設不支援CommonJS模組，我們需要藉助commonjs外掛來解決這個問題。

</br>

下載方式
  `npm i -D rollup-plugin-commonjs` 
  
</br>
配置方式:
</br>

```
import resolve from 'rollup-plugin-node-resolve'
import commonjs from 'rollup-plugin-commonjs'

export default {
  input: './src/plugin/main-cjs.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }, {
    file: './dist/index-plugin-es.js',
    format: 'es'
  }],
  plugins: [
    resolve(),
    commonjs()
  ]
}
```

9. rollup-plugin-babel 外掛
> 雖然rollup本身就會對代碼做一個基本的轉譯，但是有一些機制，像是箭頭函式 或 promise 必需要BABEL才能轉譯的。

</br>

下載方式
  `npm i -D rollup-plugin-babel`  
  
  </br>
配置範例:
</br>

```javascript

import resolve from 'rollup-plugin-node-resolve'
import commonjs from 'rollup-plugin-commonjs'
import babel from 'rollup-plugin-babel'

export default {
  input: './src/plugin/main-es.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }, {
    file: './dist/index-plugin-es.js',
    format: 'es'
  }],
  plugins: [
    resolve(),
    commonjs(),
    babel()
  ]
}
```
  
</br>

10. rollup-plugin-json 外掛
> 支援json模組

</br>

下載方式
`npm i -D rollup-plugin-json`

</br>

```javascript

import json from 'rollup-plugin-json'

export default {
  input: './src/plugin/main-json.js',
  output: [{
    file: './dist/index-plugin-cjs.js',
    format: 'cjs'
  }, {
    file: './dist/index-plugin-es.js',
    format: 'es'
  }],
  plugins: [
    resolve(),
    commonjs(),
    babel(),
    json()
  ]
}

```

</br>

11. rollup-plugin-uglify 外掛
> 程式碼壓縮（不支援ES模組）所以可用terser取代

</br>

下載方式
`npm i -D rollup-plugin-json`

</br>

其他工具:

</br>

12. @rollup/plugin-typescript 外掛
> 使用typescript的朋友可以引入此外掛
> 使用此外掛要先安裝`tslib` `typescript`，安裝方式`npm install tslib typescript --save-dev`

</br>

下載方式
`npm i -D npm install @rollup/plugin-typescript --save-dev`

</br>

配置方式
</br>

```javascript

import typescript from "rollup-plugin-typescript";
import sourceMaps from "rollup-plugin-sourcemaps";

export default {
  input: "./src/main.ts",
  plugins: [
    typescript({
      exclude: "node_modules/**",
      typescript: require("typescript")
    }),
    sourceMaps()
  ],
  output: [
    {
      format: "cjs",
      file: "lib/bundle.cjs.js",
      sourcemap: true
    },
    {
      format: "es",
      file: "lib/bundle.esm.js",
      sourcemap: true
    }
  ]
};

```

13. rollup-plugin-eslint: 提供 ESLint 能力, 需要安装和配置 ESLint 

</br>

下載方式:
`npm install rollup-plugin-eslint --save-dev`

</br>

14. rollup-plugin-serve: 類似 webpack-dev-server, 提供靜態服務器能力

</br>
下載方式:
`npm install rollup-plugin-serve --save-dev`

</br>
配置範例
</br>

```
plugins: [
    ...baseConfig.plugins,
    serve({
      port: 8080,
      contentBase: ['']
    })
  ]
```

### 總結
今天介紹完所有常見的外掛。

##### 參考資料
- rollup官網 (https://rollupjs.org/)
- 10分鐘快速入門rollup.js(https://www.itread01.com/qexxq.html)
- 10分鐘快速進階rollup.js(https://www.itread01.com/qqhkpf.html)
- Rollup打包工具的使用（超詳細，超基礎，附代碼截圖超簡單）rollup（下一代ES模塊捆綁器）(https://juejin.im/post/6844904058394771470)


